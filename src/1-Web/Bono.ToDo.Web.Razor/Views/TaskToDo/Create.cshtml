@using Bono.ToDo.Infrastructure.Resources
@model Bono.ToDo.Web.Razor.Models.TaskViewModel
@{
    ViewBag.Title = Resources.Create;
}
<h2>@Resources.Create</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">
    <h4>@Resources.Tasks</h4>
    <hr />
    @Html.ValidationSummary(true)

    @Html.Hidden("TaskIdFather", (string)ViewBag.TaskIdFather)

    <div class="form-group">
        @Html.LabelFor(m => m.Title, new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.TextBoxFor(model => model.Title, new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.Title)
        </div>
    </div>


    <div class="form-group">
        @Html.LabelFor(m => m.Description, new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.TextAreaFor(model => model.Description, new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.Description)
        </div>
    </div>

    @if (ViewBag.TaskIdFather != null)
    {
    <div class="form-group col-md-10">
        @Html.Label(null, Resources.TaskFather, new { @class = "col-md-2 control-label", @style = "margin-left: -16px;" })
        @Html.DropDownList("TaskId", null, @Resources.NoFather, new { @class = "form-select form-control chosen-select" })
    </div>
    }

    <div class="form-group col-md-10">
        @Html.Label(null, Resources.Invites, new { @class = "col-md-2 control-label", @style = "margin-left: -16px;" })
        <div style="float: right; margin-bottom: 5px; z-index: 9999;">
            <a href="#" class="btn btn-sm btn-info addToInvite"><i class="fa fa-plus-circle"></i> @Resources.Add</a>
            <a href="#" class="btn btn-sm btn-danger removeInvite"><i class="fa fa-window-close"></i> @Resources.Remove</a>
        </div>
        <select id="Invites" name="Invites" class="form-select form-control" multiple aria-label="Invites"></select>

    </div>

    <div class="form-group col-md-10">
        @Html.Label(null, Resources.Users, new { @class = "col-md-2 control-label", @style = "margin-left: -16px;" })

        @Html.DropDownList("UserList", null, new { @class = "form-select form-control", multiple = "" })


    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.IsDone, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.IsDone, new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.IsDone)
            <hr />
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-10">
            <div style="float: right; font-size: 14px;">
                <a href="/Task/Index" class="btn btn-sm btn-info">@Resources.Back</a>
                <input type="submit" value="@Resources.Save" class="btn btn-sm btn-success" />
            </div>
        </div>
    </div>
    <br /><br />
</div>
}

<div id="modalAddList" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Invite</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="InviteForm">
                    <div class="form-horizontal">
                        <div class="row mt-3">
                            <div class="validation-summary-errors col-md-12">
                                <ul>
                                    <li id="InvalidEmail" style="display: none">@Resources.InvalidEmail</li>
                                    <li id="RequiredField" style="display: none">@Resources.RequiredField</li>
                                </ul>
                            </div>
                            <label class="col-md-5 control-label">@Resources.Email</label>
                            <div class="col-md-12">
                                <input type="email" id="Invite" required class="form-control" />
                            </div>
                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <input type="button" value="@Resources.Save" class="btn btn-outline-success btn-sm btn-block btnSaveInvite" />
            </div>
        </div>
    </div>
</div>

<script>

    $(".addToInvite").click(function () {

        $("#modalAddList").modal();

    });

    $(".removeInvite").click(function () {
        var invite = $('select[name=Invites]').val()[0];

        $("#Invites").find('[value="' + invite + '"]').remove();

    });

    $("InviteForm").bind("invalid-form.validate", function () {
        alert('invalid!');
    });

    $(".btnSaveInvite").click(function () {

        $("#RequiredField").hide();
        $("#InvalidEmail").hide();

        var valid = true;
        var invite = $("#Invite").val();

        if (invite == "") {
            $("#RequiredField").show();
            valid = false;
        }

        if (!isEmail(invite)) {
            $("#InvalidEmail").show();
            valid = false;
        }

        if (valid) {
            $('#Invites').append($('<option/>', {
                value: invite,
                text: invite,
                selected: "selected"
            }));
        }

        $("#Invite").val("");
        $("#modalAddList").modal('hide');


    });

</script>

